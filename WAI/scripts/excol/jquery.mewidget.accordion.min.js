/**
 * Accordion Plugin
 * 
 * @package meWidgets
 * @author Mandana Eibegger
 *          with support from eGovMon Project and 
 *          W3C/WAI Education and Outreach Working Group (EOWG)
 *          see http://www.schoener.at/mewidgets/ for more information
 * @version v0.9 (17 Feb 2012)
 * 
 * Implements a simple accordion.
 * Extends $.fn.panelwrapper
 *  
 */
(function(a){var c=a.fn.panelwrapper;var b=a.fn.accordion=function(d){return this.each(function(){b.init(a(this),d)})};a.extend(true,b,c,{init:function(d,e,f){if(f){a.extend(b.settings,f.settings);b=f}c.init(d,e,b);b.initPanels(d);b.initControls(d)},initPanels:function(d){var g=d.find("."+b.settings.head);g.next().each(function(){g=g.not(a(this).find("."+b.settings.head))});var e="append";if(d.hasClass(b.settings.loadControl)){e="load"}else{if(d.hasClass(b.settings.prependControl)){e="prepend"}}g.each(function(){var i=a(this);var h=i.next().first();b.addPanel(i,h,d)});var f=d.metools("classSetting",b.settings.loadSpecPrefix);if(!f){f=b.settings.panelControls}b.prepareHeaders(g,f,e)},initControls:function(d){var e=d.attr("id");var f="."+b.settings.controlsPrefix+e;d.data("accordion",{controls:a(f).each(function(){var g=a(this);var h=g.data("accordionControl")?g.data("accordionControl").widgets:false;if(!h){g.data("accordionControl",a.extend(g.data("accordionControl"),{widgets:d})).metools("loadFile","",b.controlsLoaded,"",{translate:false})}else{g.data("accordionControl").widgets=h.add(d);if(g.find("."+b.settings.controlExpand).length){b.assignControls(this)}}})})},controlsLoaded:function(g){var f=a(g);var d=f.data("accordionControl").widgets;f.metools("replaceContentVars",d.prev(),true).metools("replaceContentVars",d);var e=d.data("panelWrapperWidget");f.data("accordionControl").expandSrc=f.find("."+b.settings.controlExpand+" img").attr("src");f.data("accordionControl").expandSrcDisabled=f.find("."+b.settings.controlExpand+" ."+e.panel.settings.buttonSrcDisabled).attr("title");f.data("accordionControl").collapseSrc=f.find("."+b.settings.controlCollapse+" img").attr("src");f.data("accordionControl").collapseSrcDisabled=f.find("."+b.settings.controlCollapse+" ."+e.panel.settings.buttonSrcDisabled).attr("title");f.find("."+e.panel.settings.buttonSrcDisabled).remove();b.assignControls(g)},assignControls:function(g){var f=a(g);var d=f.data("accordionControl").widgets;var h=f.data("accordionControl").initialisedWidgets;if(!h){h=a()}var e=d.not(h);f.data("accordionControl").initialisedWidgets=h.add(e);f.find("."+b.settings.controlExpand).each(function(){var i=a(this);e.each(function(){var j=a(this);i.click(function(){b.expandPanels(j.data("collapsedPanels"))})})}).end().find("."+b.settings.controlCollapse).each(function(){var i=a(this);e.each(function(){var j=a(this);i.click(function(){b.collapsePanels(j.data("expandedPanels"))})})});b.handleControls(f)},handleControls:function(e){if(e!=undefined&&e.length){var f=0;var d=0;e.each(function(){var h=a(this);var g=h.data("accordionControl").widgets;g.each(function(){f+=a(this).data("expandedPanels").length;d+=a(this).data("collapsedPanels").length})});if(f){e.each(function(){var h=a(this);var g=h.find("."+b.settings.controlCollapse);g.attr("disabled",null);if(h.data("accordionControl").collapseSrc){g.find("img").attr("src",h.data("accordionControl").collapseSrc)}})}else{e.each(function(){var h=a(this);var g=h.find("."+b.settings.controlCollapse);g.attr("disabled","disabled");if(h.data("accordionControl").collapseSrcDisabled){g.find("img").attr("src",h.data("accordionControl").collapseSrcDisabled)}})}if(d){e.each(function(){var h=a(this);var g=h.find("."+b.settings.controlExpand);g.attr("disabled",null);if(h.data("accordionControl").expandSrc){g.find("img").attr("src",h.data("accordionControl").expandSrc)}})}else{e.each(function(){var h=a(this);var g=h.find("."+b.settings.controlExpand);g.attr("disabled","disabled");if(h.data("accordionControl").expandSrcDisabled){g.find("img").attr("src",h.data("accordionControl").expandSrcDisabled)}})}}},expandStarted:function(e){var d=e[0];var f=d.data("panel").tab.data("tabSettings").wrapper;b.handleControls(f.data("accordion").controls)},collapseStarted:function(e){var d=e[0];var f=d.data("panel").tab.data("tabSettings").wrapper;b.handleControls(f.data("accordion").controls)},disableSelected:function(e,f){var d=f.data("panels");if(!d.length){f.data("accordion").controls.hide()}c.disableSelected(e,f)},resetEnabledPanels:function(f,e){var d=f.data("panels");if(d.length){f.data("accordion").controls.show()}c.resetEnabledPanels(f,e)}})})(jQuery);