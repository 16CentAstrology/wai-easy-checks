(function($,$this){$this=$.fn.metools=function(method){if($.isFunction($this[method])){var args=Array.prototype.slice.call(arguments,1);return $this[method].apply(this,args)}else{$.error("Tool "+method+" does not exist on jQuery.metools");return this}};$.extend($this,{classSetting:function(classname,findall){if(this.length>0){var reg=new RegExp(classname+"[a-zA-Z0-9_-]*","g");var classes=this.attr("class");if(classes){var variableClasses=classes.match(reg);if(variableClasses){for(var i=0;i<variableClasses.length;++i){variableClasses[i]=variableClasses[i].substr(classname.length)}if(findall){return variableClasses}else{if(variableClasses){return variableClasses[0]}}}}}return false},focusableElements:function(param1,param2){var returnAll;var options={};if(typeof(param1)=="boolean"){returnAll=param1}else{if(typeof(param1)=="object"){options=param1}}if(typeof(param2)=="object"){options=param2}var settings={focusableElements:"a,frame,iframe,label,input,select,textarea,button"};if(options.focusableElements){settings.focusableElements+=","+options.focusableElements}var focusableElements=$(this).find(settings.focusableElements);var tabindexedElements=$(this).find("*").map(function(){if($(this).attr("tabindex")){return this}});focusableElements=focusableElements.add(tabindexedElements);if(returnAll){return focusableElements}else{return focusableElements.not("*[tabindex=-1]")}},loadFile:function(defaultFile,fnOnSuccess,fnOnSuccessAll,options){var classToFileTranslations={"_-_":".","_--_":"/"};var settings={loadSpecPrefix:"f_fileToLoad_",classToFileTranslations:classToFileTranslations,translate:true,loadMethod:"append"};if(defaultFile&&typeof(defaultFile)!="string"){if(typeof(defaultFile)=="function"){fnOnSuccess=defaultFile}else{options=defaultFile}defaultFile=""}if(fnOnSuccess&&typeof(fnOnSuccess)!="function"){options=fnOnSuccess;fnOnSuccess=""}if(fnOnSuccessAll&&typeof(fnOnSuccessAll)!="function"){options=fnOnSuccessAll;fnOnSuccessAll=""}if(options){$.extend(settings,options)}var specialElements=this;if(defaultFile){specialElements=this.filter("*[class*="+settings.loadSpecPrefix+"]");$this.doLoad.apply(this.not(specialElements),Array($this.translate(defaultFile,settings.classToFileTranslations),fnOnSuccess,fnOnSuccessAll,settings))}specialElements.each(function(){var $element=$(this);var file="";var fileSpec=$this.classSetting.apply($element,Array(settings.loadSpecPrefix));if(settings.translate){file=$this.translate(fileSpec,settings.classToFileTranslations)}else{file=eval(fileSpec)}if(file){$this.doLoad.apply($element,Array(file,fnOnSuccess,fnOnSuccessAll))}});return this},doLoad:function(file,fnOnSuccess,fnOnSuccessAll,settings){var elementsNum=this.length;var elementsLoaded=0;var loadMethod="append";if(settings&&settings!=undefined&&settings.loadMethod){loadMethod=settings.loadMethod}var elements=this;var json=(file.substr(file.length-5)==".json");var request=$.ajax({type:"GET",url:file,dataType:(json?"jsonp":"html"),error:function(jqXHR,textStatus,errorThrown){console.log("Error loading "+file,jqXHR,textStatus,errorThrown)},success:function(data){if(json){data=data.html}if(loadMethod=="load"){elements.html(data)}else{if(loadMethod=="append"){elements.append(data)}else{if(loadMethod=="prepend"){elements.prepend(data)}else{if(loadMethod=="prependTo"){elements.each(function(){var prependFileTo=$(this).data("prependFileTo")?$(this).data("prependFileTo"):$(this);prependFileTo.before(data);$(this).data("prependFileTo","")})}}}}if(fnOnSuccess){elements.each(function(){fnOnSuccess($(this))})}if(fnOnSuccessAll){fnOnSuccessAll(elements)}}});return this},translate:function(text,translations){for(var translatable in translations){var reg=new RegExp(translatable,"g");text=text.replace(reg,translations[translatable])}return text},replaceContentVars:function(contentPool,options){var settings={variablePlaceholderPrefix:"f_expandVar_",variableIndicatorPrefix:"f_expandVarSet_",variableAttributes:Array("title","alt","value")};var preserveUnreplacedVars=false;if(options){if(typeof(options)=="boolean"){preserveUnreplacedVars=true}else{$.extend(settings,options)}}this.find("*[class*="+settings.variablePlaceholderPrefix+"]").each(function(){var varname=$this.classSetting.apply($(this),Array(settings.variablePlaceholderPrefix));var addToPool;if(contentPool.hasClass(settings.variableIndicatorPrefix+varname)){addToPool=contentPool}var replaceBy=contentPool.find("."+settings.variableIndicatorPrefix+varname).add(addToPool).html();if(!replaceBy){try{replaceBy=eval(varname)}catch(e){}}if(replaceBy||!preserveUnreplacedVars){$(this).replaceWith(replaceBy)}});var atbAr=settings.variableAttributes;for(var i=0;i<atbAr.length;++i){var dynamicElements=this.find("*["+atbAr[i]+"*="+settings.variablePlaceholderPrefix+"]");if(this.is("*["+atbAr[i]+"*="+settings.variablePlaceholderPrefix+"]")){dynamicElements=dynamicElements.add(this)}dynamicElements.each(function(){var aval=$(this).attr(atbAr[i]);if(aval){var reg=new RegExp(settings.variablePlaceholderPrefix+"[a-zA-Z0-9_-]*");var vars=aval.match(reg);var varname=vars[0].substr(settings.variablePlaceholderPrefix.length);var aval0=contentPool.find("."+settings.variableIndicatorPrefix+varname).first().text();if(!aval0){try{aval0=eval(varname)}catch(e){}}if(aval0||!preserveUnreplacedVars){reg=new RegExp(vars[0],"g");aval=aval.replace(reg,aval0)}$(this).attr(atbAr[i],aval)}})}return this},apply:function(fn,args){var application=fn||function(){};args=Array.prototype.slice.call(arguments,1);return this.each(function(){application.apply(this,args)})},loadCSS:function(fname,mediaStr){var styleAttribs={type:"text/css",href:fname+"?anticache="+Math.floor(Math.random()*999999),rel:"stylesheet"};if(mediaStr){$.extend(styleAttribs,{media:mediaStr})}$(document.createElement("link")).attr(styleAttribs).appendTo($("head"))},updateVirtualBuffer:function(){if(!$this.bufferUpdater){$this.bufferUpdater=$('<input type="hidden" value="1" />');$("body").append($this.bufferUpdater)}$this.bufferUpdater.attr("value",$this.bufferUpdater.val()==1?0:1)}})})(jQuery);$.fn.reverse=[].reverse;